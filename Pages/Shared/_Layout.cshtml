<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="utf-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1" />
 <title>@ViewData["Title"]</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.min.css">
 <link rel="stylesheet" href="/css/Sites.css" />
</head>
<body>
 <header>
 <nav class="navbar navbar-expand-lg navbar-dark" aria-label="Barra superior">
 <div class="container-fluid align-items-center">
 <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNav" aria-controls="offcanvasNav" aria-label="Abrir menú">
 <span class="navbar-toggler-icon"></span>
 </button>
 <div class="collapse navbar-collapse justify-content-end">
 <ul class="navbar-nav mb-2 mb-lg-0 align-items-center">
 @if (User?.Identity?.IsAuthenticated ?? false)
 {
 <li class="nav-item me-2"><span class="nav-link p-0">@User.Identity!.Name</span></li>
 <li class="nav-item">
 <form method="post" asp-page="/Logout" class="d-inline">
 <button type="submit" class="btn btn-outline-light btn-sm">Cerrar sesión</button>
 </form>
 </li>
 }
 else
 {
 <li class="nav-item"><a class="btn btn-primary btn-sm" asp-page="/Login">Iniciar sesión</a></li>
 }
 </ul>
 </div>
 </div>
 </nav>
 </header>

 <div class="offcanvas offcanvas-start bg-dark text-light" tabindex="-1" id="offcanvasNav" aria-labelledby="offcanvasNavLabel">
 <div class="offcanvas-header">
 <h5 class="offcanvas-title" id="offcanvasNavLabel">Menú</h5>
 <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
 </div>
 <div class="offcanvas-body">
 @if (User?.Identity?.IsAuthenticated ?? false)
 {
 <div class="mb-3">
 <div class="small">Usuario: <strong>@User.Identity!.Name</strong></div>
 <div class="text-muted small">Rol: @(User.IsInRole("Administrador") ? "Administrador" : "Usuario")</div>
 </div>
 <form method="post" asp-page="/Logout" class="mb-3">
 <button type="submit" class="btn btn-outline-light w-100">Cerrar sesión</button>
 </form>
 }
 <nav class="nav flex-column">
 @if (User?.Identity?.IsAuthenticated ?? false)
 {
 <a class="nav-link" asp-page="/Usuarios/Index">Usuarios</a>
				@if (User.IsInRole("Administrador") || User.IsInRole("Editor"))
				{
					<a class="nav-link" asp-page="/Pescadores/Index">Pescadores</a>
					<a class="nav-link" asp-page="/Embarcaciones/Index">Embarcaciones</a>
					<a class="nav-link" asp-page="/Especies/Index">Especies</a>
					<a class="nav-link" asp-page="/ArtePesca/Index">Artes de Pesca</a>
					<a class="nav-link" asp-page="/SitiosPesca/Index">Sitios de Pesca</a>
					<a class="nav-link" asp-page="/Insumos/Index">Insumos</a>
					<a class="nav-link" asp-page="/Proveedores/Index">Proveedores</a>
					<a class="nav-link" asp-page="/ComprasInsumos/Index">Compras de Insumos</a>
					<a class="nav-link" asp-page="/RegistrosCapturas/Index">Registros de Capturas</a>
				}
 @if (User.IsInRole("Administrador"))
 {
 <a class="nav-link" asp-page="/Admin/Index">Panel Administración</a>
 <a class="nav-link" asp-page="/Roles/Index">Roles</a>
 <a class="nav-link" asp-page="/Tools/Seed">Seed (Dev)</a>
 }
 <a class="nav-link" asp-page="/Account/ChangePassword">Cambiar contraseña</a>
 <a class="nav-link" asp-page="/Account/Profile">Mi perfil</a>
 }
 else
 {
 <a class="nav-link" asp-page="/Login">Login</a>
 }
 </nav>
 </div>
 </div>

 <div class="app-shell">
 <aside class="sidebar d-none d-lg-block" aria-label="Barra lateral">
 <div class="brand">
 <span class="logo" aria-hidden="true"></span>
 <strong>Menú</strong>
 </div>
 <div class="userbox">
 @if (User?.Identity?.IsAuthenticated ?? false)
 {
 <div class="small">Usuario: <strong>@User.Identity!.Name</strong></div>
 <div class="text-muted small">Rol: @(User.IsInRole("Administrador") ? "Administrador" : "Usuario")</div>
 }
 else
 {
 <div class="small">No ha iniciado sesión</div>
 }
 </div>
 <nav class="nav flex-column p-2">
 @if (User?.Identity?.IsAuthenticated ?? false)
 {
 <a class="nav-link" asp-page="/Usuarios/Index">Usuarios</a>
				@if (User.IsInRole("Administrador") || User.IsInRole("Editor"))
				{
					<a class="nav-link" asp-page="/Pescadores/Index">Pescadores</a>
					<a class="nav-link" asp-page="/Embarcaciones/Index">Embarcaciones</a>
					<a class="nav-link" asp-page="/Especies/Index">Especies</a>
					<a class="nav-link" asp-page="/ArtePesca/Index">Artes de Pesca</a>
					<a class="nav-link" asp-page="/SitiosPesca/Index">Sitios de Pesca</a>
					<a class="nav-link" asp-page="/Insumos/Index">Insumos</a>
					<a class="nav-link" asp-page="/Proveedores/Index">Proveedores</a>
					<a class="nav-link" asp-page="/ComprasInsumos/Index">Compras de Insumos</a>
					<a class="nav-link" asp-page="/RegistrosCapturas/Index">Registros de Capturas</a>
				}
 @if (User.IsInRole("Administrador"))
 {
 <a class="nav-link" asp-page="/Admin/Index">Panel Administración</a>
 <a class="nav-link" asp-page="/Roles/Index">Roles</a>
 <a class="nav-link" asp-page="/Tools/Seed">Seed (Dev)</a>
 }
 <a class="nav-link" asp-page="/Account/ChangePassword">Cambiar contraseña</a>
 <a class="nav-link" asp-page="/Account/Profile">Mi perfil</a>
 }
 else
 {
 <a class="nav-link" asp-page="/Login">Login</a>
 }
 </nav>
 </aside>
 <main class="content">
 <div class="container py-4">
                    @{
                        var successMsg = TempData["SuccessMessage"]?.ToString();
                        var errorMsg = TempData["ErrorMessage"]?.ToString();
                        var infoMsg = TempData["InfoMessage"]?.ToString();
                        var warningMsg = TempData["WarningMessage"]?.ToString();
                    }
                    @if (!string.IsNullOrEmpty(successMsg))
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="bi bi-check-circle-fill"></i>
                            <strong>¡Éxito!</strong> @successMsg
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(errorMsg))
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            <strong>Error:</strong> @errorMsg
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(infoMsg))
                    {
                        <div class="alert alert-info alert-dismissible fade show" role="alert">
                            <i class="bi bi-info-circle-fill"></i>
                            @infoMsg
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(warningMsg))
                    {
                        <div class="alert alert-warning alert-dismissible fade show" role="alert">
                            <i class="bi bi-exclamation-circle-fill"></i>
                            <strong>Advertencia:</strong> @warningMsg
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                        </div>
                    }
                    @RenderBody()
                </div>
            </main>
        </div>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
         integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
         crossorigin="anonymous"></script>
 <script src="~/js/form-persistence.js"></script>
 <script nonce="@Context.Items["csp-nonce"]">
     // Auto-dismiss alertas de éxito e info después de 5 segundos
     document.addEventListener('DOMContentLoaded', function() {
         const successAlerts = document.querySelectorAll('.alert-success, .alert-info');
         successAlerts.forEach(function(alert) {
             setTimeout(function() {
                 const bsAlert = new bootstrap.Alert(alert);
                 bsAlert.close();
             }, 5000);
         });
     });
 </script>
 @RenderSection("Scripts", required: false)
</body>
</html>
